{% extends 'base.html' %}

{% block title %}Carrito de Viajes{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row">
        <div class="col-12">
            <h1 class="text-primary mb-4">üõí Tu Carrito de Viajes</h1>
        </div>
    </div>

    {% if carrito %}
    <div class="row">
        <div class="col-lg-8">
            <div class="card shadow-lg border-0">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">‚úàÔ∏è Tus Viajes Seleccionados</h4>
                </div>
                <div class="card-body">
                    {% for p in carrito %}
                    <div class="cart-item mb-4 p-3 border rounded">
                        <div class="row">
                            <div class="col-md-3">
                                <img src="{{ url_for('static', filename='uploads/' + p.imagen) }}" 
                                     class="img-fluid rounded" 
                                     alt="{{ p.nombre_producto }}">
                            </div>
                            <div class="col-md-9">
                                <div class="row">
                                    <div class="col-md-8">
                                        <h5 class="text-primary">{{ p.nombre_producto }}</h5>
                                        <p class="text-muted mb-3">{{ p.descripcion or 'Paquete de viaje completo' }}</p>
                                        
                                        <!-- Informaci√≥n del Viaje -->
                                        <div class="travel-info-section">
                                            <h6 class="text-primary mb-3">üìÖ Configura tu Viaje</h6>
                                            
                                            <div class="row g-3">
                                                <!-- Tipo de Viaje -->
                                                <div class="col-md-6">
                                                    <label class="form-label small fw-bold">Tipo de Viaje</label>
                                                    <select class="form-select form-select-sm travel-option" name="tipo_viaje">
                                                        <option value="solo_vuelo">‚úàÔ∏è Solo Vuelo</option>
                                                        <option value="vuelo_hotel" selected>üè® Vuelo + Hotel</option>
                                                        <option value="todo_incluido">üåü Todo Incluido</option>
                                                        <option value="personalizado">üéØ Personalizado</option>
                                                    </select>
                                                </div>
                                                
                                                <!-- Clase -->
                                                <div class="col-md-6">
                                                    <label class="form-label small fw-bold">Clase</label>
                                                    <select class="form-select form-select-sm travel-option" name="clase">
                                                        <option value="economica" selected>üí∫ Econ√≥mica</option>
                                                        <option value="ejecutiva">‚ú® Ejecutiva</option>
                                                        <option value="primera">üé© Primera Clase</option>
                                                    </select>
                                                </div>
                                                
                                                <!-- Fechas -->
                                                <div class="col-md-6">
                                                    <label class="form-label small fw-bold">Fecha de Salida</label>
                                                    <input type="date" class="form-control form-control-sm travel-option" 
                                                           name="fecha_salida" value="{{ hoy }}" min="{{ hoy }}">
                                                </div>
                                                
                                                <div class="col-md-6">
                                                    <label class="form-label small fw-bold">Fecha de Regreso</label>
                                                    <input type="date" class="form-control form-control-sm travel-option" 
                                                           name="fecha_regreso" value="{{ hoy }}">
                                                </div>
                                                
                                                <!-- Pasajeros -->
                                                <div class="col-md-4">
                                                    <label class="form-label small fw-bold">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Adultos</label>
                                                    <select class="form-select form-select-sm travel-option" name="adultos">
                                                        <option value="1">1 Adulto</option>
                                                        <option value="2" selected>2 Adultos</option>
                                                        <option value="3">3 Adultos</option>
                                                        <option value="4">4 Adultos</option>
                                                    </select>
                                                </div>
                                                
                                                <div class="col-md-4">
                                                    <label class="form-label small fw-bold">üßí Ni√±os</label>
                                                    <select class="form-select form-select-sm travel-option" name="ninos">
                                                        <option value="0" selected>0 Ni√±os</option>
                                                        <option value="1">1 Ni√±o</option>
                                                        <option value="2">2 Ni√±os</option>
                                                        <option value="3">3 Ni√±os</option>
                                                    </select>
                                                </div>
                                                
                                                <div class="col-md-4">
                                                    <label class="form-label small fw-bold">üõå Habitaci√≥n</label>
                                                    <select class="form-select form-select-sm travel-option" name="habitacion">
                                                        <option value="sencilla" selected>üõèÔ∏è Sencilla</option>
                                                        <option value="doble">üõèÔ∏èüõèÔ∏è Doble</option>
                                                        <option value="suite">üè∞ Suite</option>
                                                    </select>
                                                </div>
                                                
                                                <!-- Comentarios Adicionales -->
                                                <div class="col-12">
                                                    <label class="form-label small fw-bold">üí¨ Comentarios Especiales</label>
                                                    <textarea class="form-control form-control-sm travel-option" 
                                                              name="comentarios" rows="2" 
                                                              placeholder="Alergias alimenticias, necesidades especiales, etc."></textarea>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-4">
                                        <div class="text-end">
                                            <div class="price-section mb-3">
                                                <h4 class="text-success fw-bold">${{ "{:,.0f}".format(p.precio) }}</h4>
                                                <small class="text-muted">por persona</small>
                                            </div>
                                            
                                            <div class="travel-duration mb-3">
                                                <small class="text-muted">
                                                    <i class="fas fa-calendar me-1"></i>
                                                    <strong>Duraci√≥n:</strong> 7 d√≠as / 6 noches
                                                </small>
                                            </div>
                                            
                                            <div class="includes-section mb-3">
                                                <small class="text-success">
                                                    <strong>‚úÖ Incluye:</strong><br>
                                                    ‚Ä¢ Vuelo ida y vuelta<br>
                                                    ‚Ä¢ Hotel 4‚òÖ<br>
                                                    ‚Ä¢ Desayuno incluido<br>
                                                    ‚Ä¢ Tours guiados
                                                </small>
                                            </div>
                                            
                                            <a href="{{ url_for('eliminar_del_carrito', index=loop.index0) }}" 
                                               class="btn btn-outline-danger btn-sm">
                                                <i class="fas fa-trash me-1"></i> Eliminar
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <div class="card shadow-lg border-0 sticky-top" style="top: 20px;">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0">üìã Resumen de Compra</h5>
                </div>
                <div class="card-body">
                    <!-- Resumen de Costos -->
                    <div class="cost-summary mb-4">
                        <div class="d-flex justify-content-between mb-2">
                            <span>Subtotal:</span>
                            <span>${{ total }}</span>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span>Impuestos (10%):</span>
                            <span>${{ (total|float * 0.1)|round(2) }}</span>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span>Seguro de viaje:</span>
                            <span>${{ (total|float * 0.05)|round(2) }}</span>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span>Tasas aeroportuarias:</span>
                            <span>$50.00</span>
                        </div>
                        <hr>
                        <div class="d-flex justify-content-between mb-3">
                            <strong>Total:</strong>
                            <strong class="text-success">${{ (total|float * 1.15 + 50)|round(2) }}</strong>
                        </div>
                    </div>
                    
                    <!-- Informaci√≥n Importante -->
                    <div class="travel-policies mb-4">
                        <h6 class="text-primary">üìù Informaci√≥n Importante</h6>
                        <div class="small">
                            <p class="mb-2"><strong>Pol√≠ticas de cancelaci√≥n:</strong></p>
                            <ul class="small ps-3 mb-3">
                                <li>Cancelaci√≥n 30+ d√≠as: 90% de reembolso</li>
                                <li>Cancelaci√≥n 15-29 d√≠as: 50% de reembolso</li>
                                <li>Cancelaci√≥n 0-14 d√≠as: Sin reembolso</li>
                            </ul>
                            
                            <p class="mb-2"><strong>Documentaci√≥n requerida:</strong></p>
                            <ul class="small ps-3">
                                <li>Pasaporte vigente</li>
                                <li>Visas seg√∫n destino</li>
                                <li>Seguro de viaje</li>
                            </ul>
                        </div>
                    </div>
                    
                    <!-- M√©todos de Pago (SIN CAMBIOS) -->
                    <form action="{{ url_for('procesar_pago') }}" method="POST">
                        <div class="payment-methods mb-4">
                            <h6 class="text-primary">üí≥ M√©todo de Pago</h6>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="metodo_pago" id="nequi" value="nequi" required>
                                <label class="form-check-label" for="nequi">
                                    <i class="fas fa-mobile-alt me-2"></i>Nequi
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="metodo_pago" id="bancolombia" value="bancolombia">
                                <label class="form-check-label" for="bancolombia">
                                    <i class="fas fa-university me-2"></i>Bancolombia
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="metodo_pago" id="tarjeta" value="tarjeta">
                                <label class="form-check-label" for="tarjeta">
                                    <i class="fas fa-credit-card me-2"></i>Tarjeta de Cr√©dito
                                </label>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="termsCheck" name="terms" required>
                                <label class="form-check-label small" for="termsCheck">
                                    Acepto los <a href="#" class="text-primary">t√©rminos y condiciones</a> y las pol√≠ticas de cancelaci√≥n
                                </label>
                            </div>
                        </div>
                        
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary btn-lg">
                                üé´ Proceder al Pago
                            </button>
                            <a href="{{url_for('catalogo')}}" class="btn btn-outline-primary">
                                ‚úàÔ∏è Seguir Explorando
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    {% else %}
    <div class="row">
        <div class="col-12">
            <div class="card shadow-lg border-0 text-center py-5">
                <div class="card-body">
                    <i class="fas fa-shopping-cart display-1 text-muted mb-4"></i>
                    <h3 class="text-muted">Tu carrito est√° vac√≠o</h3>
                    <p class="text-muted mb-4">Descubre destinos incre√≠bles y agr√©galos a tu carrito</p>
                    <a href="{{url_for('catalogo')}}" class="btn btn-primary btn-lg">
                        ‚úàÔ∏è Explorar Destinos
                    </a>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>

 

<script>
document.addEventListener('DOMContentLoaded', function() {
    const fechaSalidaInputs = document.querySelectorAll('input[name="fecha_salida"]');
    const fechaRegresoInputs = document.querySelectorAll('input[name="fecha_regreso"]');
    
    fechaSalidaInputs.forEach((fechaSalida, index) => {
        const fechaRegreso = fechaRegresoInputs[index];
        
        fechaSalida.addEventListener('change', function() {
            if (this.value) {
                fechaRegreso.min = this.value;
            }
        });
    });
    
    const travelOptions = document.querySelectorAll('.travel-option');
    travelOptions.forEach(option => {
        option.addEventListener('change', function() {
            this.style.borderColor = '#0d6efd';
            this.style.boxShadow = '0 0 0 0.2rem rgba(13, 110, 253, 0.25)';
            setTimeout(() => {
                this.style.borderColor = '';
                this.style.boxShadow = '';
            }, 1000);
        });
    });
});
</script>
{% endblock %}