{% extends 'base.html' %}

{% block title %}Inventario{% endblock %}

{% block content %}

<div class="container mb-4">
    <h3>Gestion de Inventario</h3>

    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalAgregar">Agregar productos</button>
<br><br>
    <table class="table table-bordered table-hover">
        <thead class="table-light">
            <tr>
                <th>Imagen</th>
                <th>Nombre</th>
                <th>Descripcion</th>
                <th>Precio</th>
                <th>Cantidad</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for p in productos %}
            <tr>
                <td><img src="{{url_for('static', filename='uploads/' + p.imagen)}}" width="80"></td>
                <td>{{ p.nombre_producto }}</td>
                <td>{{ p.descripcion }}</td>
                <td>${{ "{:,.0f}".format (p.precio) }}</td>
                <td>{{ p.cantidad }}</td>
                <td>
                    <button class="btn btn-warning btn-sm" data-bs-toggle="modal"
                        data-bs-target="#ModalEdit{{ p ['idProducto']}}">Editar</button>
                    <button class="btn btn-danger btn-sm" data-bs-toggle="modal"
                        data-bs-target="#ModalEliminar {{ p ['idProducto']}}">Eliminar</button>

                </td>
            </tr>
            {% endfor %}
        </tbody>

    </table>
    <div class="modal" id="modalAgregar" tabindex="-1">
        <div class="modal-dialog">
            <form method="POST" action="{{url_for('agregar_producto')}}" enctype="multipart/form-data">
                <div class="modal-content">

                    <!-- Modal Header -->
                    <div class="modal-header">
                        <h4 class="modal-title">Agregar Productos</h4>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>

                    <!-- Modal body -->
                    <div class="modal-body">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label  class="titulo" class="titulo" for="nombre" class="form-label">Nombre</label>
                                <input type="text" class="form-control" name="nombre" id="nombre" required>
                            </div>

                            <div class="col-md-6">
                                <label for="precio" class="form-label">Precio</label>
                                <input type="number" class="form-control" name="precio" id="precio" required>
                            </div>
                            <div class="col-md-12">
                                <label for="descripcion" class="form-label">Descripcion</label>
                                <textarea class="form-control" name="descripcion" id="descripcion" rows="3"></textarea>
                            </div>
                            <div class="col-md-6">
                                <label for="cantidad" class="form-label">Cantidad</label>
                                <input type="number" class="form-control" name="cantidad" id="cantidad" required>
                            </div>
                            <div class="col-md-6">
                                <label for="imagen" class="form-label">Imagen</label>
                                <input type="file" class="form-control" name="imagen" id="imagen" required>
                            </div>
                        </div>
                    </div>

                    <!-- Modal footer -->
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-success">Guardar</button>
                        <button type="button" class="btn btn-outline-secundary"
                            data-bs-dismiss="modal">Cancelar</button>
                    </div>

                </div>
            </form>
        </div>
    </div>


    {% for p in productos %}
    <!-- The Modal Edit -->
    <div class="modal" id="ModalEdit{{ p ['idProducto']}}" tabindex="-1" role="dialog"
        aria-labelledby="EditModalLabel {{ p ['idProducto']}}" aria-hidden="true">
        <div class="modal-dialog">
            <form action="{{url_for('actualizarProducto', id=  p ['idProducto'])}}" method="POST"
                enctype="multipart/form-data">
                <div class="modal-content">

                    <!-- Modal Header -->
                    <div class="modal-header">
                        <h4 class="modal-title" id="EditModalLabel {{ p ['idProducto']}}">Editar Producto:
                            {{ p['nombre_producto']}} </h4>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>

                    <!-- Modal body -->
                    <div class="modal-body">
                        <div class="form-group">
                            <label class="subtitulo" for="nombre {{ p ['idProducto']}}">Nombre</label>
                            <input type="text" class="form-control" name="nombre" id="nombre{{  p ['idProducto']}}"
                                value="{{ p['nombre_producto']}}" required>
                        </div>

                        <div class="form-group">
                            <label class="subtitulo" for="descripcion {{  p ['idProducto']}}">Descripcion</label>
                            <input type="text" class="form-control" name="descripcion"
                                id="descripcion{{ p ['idProducto']}}" value="{{ p['descripcion']}}" required>
                        </div>

                        <div class="form-group">
                            <label  class="subtitulo" for="precio {{ p ['idProducto']}}">Precio</label>
                            <input type="number" class="form-control" name="precio" id="precio{{  p ['idProducto']}}"
                                value="{{ p['precio']}}" required>
                        </div>

                        <div class="form-group">
                            <label class="cantidad" for="precio {{ p ['idProducto']}}">Cantidad</label>
                            <input type="number" class="form-control" name="cantidad" id="cantidad{{  p ['cantidad']}}"
                                value="{{ p['cantidad']}}" required>
                        </div>

                        <div class="form-group">
                            <label class="imagen" for="precio {{ p ['idProducto']}}">Imagen</label>
                            <input type="file" class="form-control" name="imagen" id="imagen{{  p ['imagen']}}"
                                value="{{ p['imagen']}}" required>
                        </div>
                    </div>


                    <!-- Modal footer -->
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary">Guardar cambios</button>
                        <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
                    </div>

                </div>
            </form>
        </div>
    </div>
</div>
<!-- The Modal -->
<div class="modal" id="ModalEliminar{{p['idProducto']}}" tabindex="-1" role="dialog"
    aria-labelledby="modalLabel{{p['idProducto']}}" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">


            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="titulo" class="modal-title" id="modalLabel{{p['idProducto']}}">Confirmar Eliminacion</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <!-- Modal body -->
            <div class="titulo" class="modal-body">
                Â¿Estas seguro de que quieres eliminar el producto <strong> {{p['nombre_producto']}}</strong>?
            </div>

            <!-- Modal footer -->
            <div class="modal-footer">
                <button type="button" class="btn btn-secundary" data-bs-dismiss="modal">Cancelar</button>
                <a href="{{url_for('eliminarProducto', id=p['idProducto'])}}" class="btn btn-danger">Eliminar</a>
            </div>

        </div>
    </div>
</div>
{% endfor %}
</div>

{% endblock %}